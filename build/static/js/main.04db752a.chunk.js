(this["webpackJsonpecon-game"]=this["webpackJsonpecon-game"]||[]).push([[0],{133:function(e,t,n){},146:function(e,t,n){},147:function(e,t,n){"use strict";n.r(t);var a=n(9),c=n(0),s=n.n(c),r=n(28),o=n.n(r),i=(n(133),n(21)),u=n(11),l=n(14),d=n(51),j=n(20),b=n(75),h=n.n(b),O=n(125),f=function(){return"undefined"!==typeof window},m=function(){return f()&&window.localStorage.getItem("user")?JSON.parse(window.localStorage.getItem("user")):{}},x=function(){var e=Object(O.a)(h.a.mark((function e(t){var n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!f()){e.next=14;break}if(window.localStorage.setItem("user",JSON.stringify(t)),!t.email){e.next=14;break}return e.prev=3,e.next=6,l.a.database().ref("/admins/".concat(t.uid)).once("value");case 6:n=e.sent,console.log(n.val()),window.localStorage.setItem("isAdmin",n.val()),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(3),console.error(e.t0);case 14:case"end":return e.stop()}}),e,null,[[3,11]])})));return function(t){return e.apply(this,arguments)}}(),g=function(){return!(!f()||!window.localStorage.getItem("isAdmin"))&&JSON.parse(window.localStorage.getItem("isAdmin"))},p=function(){var e=Object(j.g)();return Object(a.jsxs)(u.ButtonDropdown,{children:[Object(a.jsx)(u.ButtonDropdown.Item,{main:!0,children:m().displayName}),Object(a.jsx)(u.ButtonDropdown.Item,{onClick:function(){return e=l.a,new Promise((function(t){e.auth().signOut().then((function(){x({}),t()}))}));var e},children:"Log out"}),g()&&Object(a.jsx)(u.ButtonDropdown.Item,{onClick:function(){e.push("/admin")},children:"Admin"})]})},v=function(e){var t=e.questionID;e.setGameStatus;console.log(t);var n=Object(u.useToasts)(),s=Object(i.a)(n,2)[1],r=Object(c.useState)(""),o=Object(i.a)(r,2),d=o[0],j=o[1],b=Object(c.useState)(!0),h=Object(i.a)(b,2),O=h[0],f=h[1],m=Object(c.useState)(!1),x=Object(i.a)(m,2),g=x[0],v=x[1],w=Object(c.useState)(""),S=Object(i.a)(w,2),k=S[0],C=S[1],B=Object(c.useState)(!1),I=Object(i.a)(B,2),y=I[0],N=I[1],A=Object(c.useState)(!1),T=Object(i.a)(A,2),q=T[0],G=T[1];return Object(c.useEffect)((function(){l.a.database().ref("/questions/".concat(t)).once("value",(function(e){console.log(e.val().answers);var t=e.val();j(t),N(!1),v(!1),C(""),G(!1),f(!1)}))}),[t]),y?Object(a.jsx)(u.Loading,{className:"loading",size:"large",children:"Waiting for everyone else to catch up"}):Object(a.jsxs)("div",{children:[Object(a.jsxs)("div",{className:"quiz-header",children:[Object(a.jsxs)(u.Breadcrumbs,{className:"quiz-breadcrumbs",children:[Object(a.jsx)(u.Breadcrumbs.Item,{href:"#",children:"The Invisible Hand"}),Object(a.jsx)(u.Breadcrumbs.Item,{href:"#",children:"Questions"}),Object(a.jsx)(u.Breadcrumbs.Item,{className:"question-breadcrumb",children:t})]}),Object(a.jsx)(p,{})]}),Object(a.jsx)(u.Card,{shadow:!0,className:"question-card",children:O?Object(a.jsx)(u.Loading,{}):Object(a.jsxs)(a.Fragment,{children:[Object(a.jsx)(u.Text,{h3:!0,children:d.title}),Object(a.jsx)("div",{className:"button-grid",children:Object.keys(d.answers).map((function(e){return Object(a.jsx)(u.Button,{loading:k===e,disabled:g,size:"large",className:"quiz-button",onClick:function(){return function(e,n,a){C(e),v(!0),l.a.database().ref("/answers/".concat(t,"/").concat(e)).transaction((function(e){return e+1})).catch((function(e){G(!0),v(!1),C(null),console.error(e)})),l.a.database().ref("/answers/score").transaction((function(e){return e+(a||0)})).catch((function(e){G(!0),v(!1),C(null),console.error(e)})),l.a.database().ref("/answers/cash").transaction((function(e){return e+(n||0)})).catch((function(e){G(!0),v(!1),C(null),console.error(e)})),l.a.database().ref("/users/".concat(l.a.auth().currentUser.email.split("@")[0],"/questions/").concat(t)).transaction((function(){return e})).catch((function(e){G(!0),s({text:"Something went wrong, try again. "}),v(!1),C(null),console.error(e)})),l.a.database().ref("/users/".concat(l.a.auth().currentUser.email.split("@")[0],"/cash")).transaction((function(e){return e+(n||0)})).catch((function(e){G(!0),s({text:"Something went wrong, try again. "}),v(!1),C(null),console.error(e)})),l.a.database().ref("/users/".concat(l.a.auth().currentUser.email.split("@")[0],"/score")).transaction((function(e){return e+(a||0)})).catch((function(e){G(!0),s({text:"Something went wrong, try again. "}),v(!1),C(null),console.error(e)})),C(""),q||s({text:"Your answer was submitted"}),setTimeout((function(){N(!0)}),1500)}(e,d.answers[e].cash,d.answers[e].score)},children:d.answers[e].title},e)}))})]})})]})},w=(n(146),n(71)),S=n(127),k=function(e){var t=e.component,n=e.authed,c=Object(S.a)(e,["component","authed"]);return Object(a.jsx)(j.b,Object(w.a)(Object(w.a)({},c),{},{render:function(e){return!0===n?Object(a.jsx)(t,Object(w.a)({},e)):Object(a.jsx)(j.a,{to:{pathname:"/",state:{from:e.location}}})}}))},C=function(e){var t=e.label,n=e.stat;return Object(a.jsxs)(u.Card,{hoverable:!0,children:[Object(a.jsx)(u.Text,{h3:!0,size:"2rem",children:n}),Object(a.jsx)("p",{children:t})]})},B=function(e){var t=e.step,n=void 0===t?1:t,a=e.min,c=void 0===a?1:a,s=e.max,r=void 0===s?5:s,o=e.setToasts;l.a.database().ref("/game/activeQuestion").transaction((function(e){var t=parseInt(e[1]);return(t+=n)<c?(o({text:"You can't go backwards any more!"}),t=c):t>r&&(o({text:"You can't go forwards any more!"}),t=r),"q".concat(t)})).catch((function(e){console.error(e)}))},I=function(e){l.a.database().ref("/game/status").transaction((function(){return e})).catch((function(e){console.error(e)}))},y=function(e){var t=e.modalOpen,n=e.setModalOpen,c=function(){n(!1)};return Object(a.jsxs)(u.Modal,{open:t,onClose:c,children:[Object(a.jsx)(u.Modal.Title,{children:"Start Game"}),Object(a.jsx)(u.Modal.Content,{style:{textAlign:"center"},children:"Starting the game will clear all previous game data"}),Object(a.jsx)(u.Modal.Action,{passive:!0,onClick:c,children:"Cancel"}),Object(a.jsx)(u.Modal.Action,{className:"danger-modal-button",onClick:function(){return N(n)},children:"Start Game"})]})},N=function(e){l.a.database().ref("/answers").transaction((function(){return null})).catch((function(e){console.error(e)})),l.a.database().ref("/users").transaction((function(){return null})).catch((function(e){console.error(e)})),e(!1),I("question")},A=function(){var e=Object(c.useState)(0),t=Object(i.a)(e,2),n=t[0],s=t[1],r=Object(c.useState)(!1),o=Object(i.a)(r,2),d=o[0],j=o[1],b=Object(u.useToasts)(),h=Object(i.a)(b,2)[1],O=Object(c.useState)({}),f=Object(i.a)(O,2),m=f[0],x=f[1];return Object(c.useEffect)((function(){l.a.database().ref("users").on("value",(function(e){e.val()&&s(Object.keys(e.val()).length)})),l.a.database().ref("game").on("value",(function(e){e.val()&&x(e.val())}))}),[]),Object(a.jsxs)(a.Fragment,{children:[Object(a.jsxs)(u.Text,{h2:!0,children:["Admin Page ",Object(a.jsxs)(u.Dot,{className:"admin-dot-indicator",children:[n," Users"]})]}),Object(a.jsxs)("div",{className:"admin-content",children:[Object(a.jsxs)("div",{className:"admin-quickstats",children:[Object(a.jsx)(C,{stat:"+89",label:"Societal Score"}),Object(a.jsx)(C,{stat:"$3004",label:"Average Cash"}),Object(a.jsx)(C,{stat:{question:m.activeQuestion}[m.status]||"-",label:{question:"Active Question",waiting:"Waiting for Game to Start",gameEnded:"Game Ended"}[m.status]})]}),Object(a.jsxs)("div",{className:"admin-quiz-buttons",children:[Object(a.jsxs)(u.ButtonGroup,{children:[Object(a.jsx)(u.Button,{onClick:function(){return I("waiting")},children:"Waiting"}),Object(a.jsx)(u.Button,{onClick:function(){return j(!0)},children:"Start Game"}),Object(a.jsx)(u.Button,{onClick:function(){return I("question")},children:"Resume Game"}),Object(a.jsx)(u.Button,{onClick:function(){return I("gameEnded")},children:"End Game"})]}),Object(a.jsxs)(u.ButtonGroup,{children:[Object(a.jsx)(u.Button,{onClick:function(){return B({step:-1,setToasts:h})},children:"Previous Question"}),Object(a.jsx)(u.Button,{onClick:function(){return B({setToasts:h})},children:"Next Question"})]})]})]}),Object(a.jsx)(y,{modalOpen:d,setModalOpen:j})]})};l.a.initializeApp({apiKey:"AIzaSyDN_i9crnVUhgOak4rGRCpAkrFtfWHWJh0",authDomain:"the-invisible-hand-933c9.firebaseapp.com",databaseURL:"https://the-invisible-hand-933c9-default-rtdb.firebaseio.com",projectId:"the-invisible-hand-933c9",storageBucket:"the-invisible-hand-933c9.appspot.com",messagingSenderId:"1063063138020",appId:"1:1063063138020:web:61cc687531fbc2682f06f1"});var T=function(){var e=l.a.database().ref("game"),t=Object(c.useState)(!1),n=Object(i.a)(t,2),s=n[0],r=n[1],o=Object(c.useState)(!1),b=Object(i.a)(o,2),h=b[0],O=b[1],f=Object(c.useState)("waiting"),m=Object(i.a)(f,2),p=m[0],w=m[1],S=Object(c.useState)(""),C=Object(i.a)(S,2),B=C[0],I=C[1],y=Object(c.useState)(!0),N=Object(i.a)(y,2),T=N[0],q=N[1];Object(c.useEffect)((function(){e.on("value",(function(e){I(e.val().activeQuestion),w(e.val().status||"waiting"),q(!1)}))}),[e]);var G=new l.a.auth.GoogleAuthProvider;return G.setCustomParameters({login_hint:"000000@pdsb.net",hd:"pdsb.net"}),Object(c.useEffect)((function(){var e=l.a.auth().onAuthStateChanged((function(e){r(!!e)}));return function(){return e()}}),[]),s?Object(a.jsxs)(u.GeistProvider,{theme:{type:"dark"},children:[Object(a.jsx)(u.CssBaseline,{}),Object(a.jsx)("div",{className:"App",children:Object(a.jsx)(d.a,{children:Object(a.jsxs)(j.d,{children:[Object(a.jsxs)(j.b,{path:"/",exact:!0,children:[console.log(p),T?Object(a.jsx)(u.Loading,{}):{waiting:Object(a.jsx)(u.Text,{h2:!0,children:" Waiting for game to start..."}),question:Object(a.jsx)(v,{questionID:B}),gameEnded:Object(a.jsx)(u.Text,{h2:!0,children:"Game Ended"})}[p]||Object(a.jsx)(u.Text,{h1:!0,children:"Something went wrong"})]}),Object(a.jsx)(k,{authed:g(),path:"/admin",component:A})]})})})]}):Object(a.jsxs)(u.GeistProvider,{theme:{type:"dark"},children:[Object(a.jsx)(u.CssBaseline,{}),Object(a.jsxs)("div",{className:"App",children:[Object(a.jsxs)(u.Text,{h2:!0,children:["Please Login to Play ",Object(a.jsx)(u.Text,{i:!0,children:"The Invisible Hand"})]}),Object(a.jsx)(u.Note,{style:{width:"fit-content",marginBottom:"24px"},children:"You will need to use your PDSB.net account"}),Object(a.jsx)(u.Button,{type:"secondary",ghost:!0,loading:h,onClick:function(){O(!0),l.a.auth().setPersistence(l.a.auth.Auth.Persistence.LOCAL).then((function(){l.a.auth().signInWithPopup(G).then((function(e){x(e.user)}))}))},children:"Login"})]})]})},q=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,148)).then((function(t){var n=t.getCLS,a=t.getFID,c=t.getFCP,s=t.getLCP,r=t.getTTFB;n(e),a(e),c(e),s(e),r(e)}))};o.a.render(Object(a.jsx)(s.a.StrictMode,{children:Object(a.jsx)(T,{})}),document.getElementById("root")),q()}},[[147,1,2]]]);
//# sourceMappingURL=main.04db752a.chunk.js.map